
tables:
  gdccase:
    driver: web
    config:
      list:
        url: https://api.gdc.cancer.gov/cases
        elementList: "$.data.hits"
        params:
          size: "100"
          expand: project
        pager:
          code: >
            def pager(url, result):
              p = result['data']['pagination']
              if p['page'] >= p['pages']:
                return None
              return { "from" : p["from"] + p["count"] }
          method: pager
      get:
        id:
          url: https://api.gdc.cancer.gov/cases
          params:
            filters: >
              {
                 "op":"in",
                 "content":{
                    "field":"case_id",
                    "value":["{{id}}"]
                 }
              }
          element: "$.data.hits[0]"
        submitter_id:
          url: https://api.gdc.cancer.gov/cases
          params:
            filters: >
              {
                 "op":"in",
                 "content":{
                    "field":"submitter_id",
                    "value":["{{id}}"]
                 }
              }
          elementList: "$.data.hits"
        project.project_id:
          url: https://api.gdc.cancer.gov/cases
          params:
            size: "200"
            filters: >
              {
                 "op":"in",
                 "content":{
                    "field":"project.project_id",
                    "value":["{{id}}"]
                 }
              }
          elementList: "$.data.hits"

  gdcproject:
    driver: web
    config:
      list:
        url: https://api.gdc.cancer.gov/projects
        elementList: "$.data.hits"
        cache: true
        params:
          size: "100"

  gdc_smm_occurance:
    driver: web
    config:
      get:
        case_id:
          url: https://api.gdc.cancer.gov/ssm_occurrences
          params:
            expand: case
            filters: >
              {
                 "op":"in",
                 "content":{
                    "field":"case.case_id",
                    "value":["{{case_id}}"]
                 }
              }
          elementList: "$.data.hits"

        ssm_occurrence_id:
            url: https://api.gdc.cancer.gov/ssm_occurrences
            params:
              expand: case
              filters: >
                {
                   "op":"in",
                   "content":{
                      "field":"ssm_occurrence_id",
                      "value":["{{ssm_occurrence_id}}"]
                   }
                }
            element: "$.data.hits[0]"

  ssm:
    driver: web
    config:
      get:
        cosmic_id:
          url: https://api.gdc.cancer.gov/ssms
          params:
            filter: >
              {
                "op":"in",
                "content":{
                  "field":"cosmic_id",
                  "value":[
                     "{{cosmic_id}}"
                  ]
               }

  pdc_public_case:
    driver: web
    config:
      list:
        cache: True
        insecure: true
        url: https://pdc.esacinc.com/graphql
        elementList: "$.data.allCases"
        params:
          query: "{allCases {case_id case_submitter_id project_submitter_id disease_type primary_site}}"

  pdc_case:
    driver: web
    config:
      get:
        case_id:
          url: https://pdc.esacinc.com/graphql
          element: "$.data.case"
          params:
            query: >
              query {
                case(case_id:"{{id}}") {
                  case_id
                  case_submitter_id
                  project_submitter_id
                  external_case_id
                  tissue_source_site_code
                  days_to_lost_to_followup
                  disease_type
                  index_date
                  lost_to_followup
                  primary_site
                  count
                  demographics {
                    demographic_id
                    demographic_submitter_id
                    ethnicity
                    gender
                    race
                    cause_of_death
                    days_to_birth
                    days_to_death
                    vital_status
                    year_of_birth
                    year_of_death
                  }
                  project {
                    project_id
                  }
                  samples {
                    sample_id
                  }
                }
              }


  pdcproject:
    driver: web
    config:
      list:
        cache: True
        insecure: true
        url: https://pdc.esacinc.com/graphql
        elementList: "$.data.projectsPerExperimentType"
        params:
          query: "{projectsPerExperimentType{experiment_type project_submitter_id name}}"

  pdcspectra:
    driver: web
    config:
      get:
        gene:

          params:
            query: >
              query {
                getPaginatedUIGeneStudySpectralCount(gene_name:"{{gene}}") {
                  total
                  spectralCounts {
                    gene_name
                    study_submitter_id
                    project_submitter_id
                    aliquot_id
                    plex
                    spectral_count
                    distinct_peptide
                    unshared_peptide
                  }
                }
              }

  hugo:
    driver: web
    config:
      get:
        symbol:
          url: http://rest.genenames.org/fetch/symbol/{{symbol}}
          headers:
            - "Accept:application/json"
          params:
            format: json
          element: "$.response.docs[0]"

vertices:
  "gdc.cancer.gov/case/" :
    table: gdccase
    primaryKey: id
    label: Case

  "gdc.cancer.gov/project/" :
    table: gdcproject
    primaryKey: id
    label: Project

  "pdc.esacinc.com/public_case/" :
    table: pdc_public_case
    primaryKey: case_id
    label: PDCPublicCase

  "pdc.esacinc.com/case/" :
    table: pdc_case
    primaryKey: case_id
    label: PDCCase

  "pdc.esacinc.com/project/" :
    table: pdcproject
    primaryKey: project_submitter_id
    label: PDCProject


  "gdc.cancer.gov/ssm_occurrence/" :
    table: gdc_smm_occurance
    primaryKey: ssm_occurrence_id
    label: SSMoccurrence

  "genenames.org/gene/" :
    table: hugo
    primaryKey: symbol
    label: Gene

edges:
  ssms:
    fromVertex: "gdc.cancer.gov/case/"
    toVertex: "gdc.cancer.gov/ssm_occurrence/"
    label: ssms
    toField: case_id
    fromField: id

  projectCase:
    fromVertex: "gdc.cancer.gov/project/"
    toVertex: "gdc.cancer.gov/case/"
    label: cases
    toField: project.project_id
    fromField: id

  gdcRecord:
    fromVertex: "pdc.esacinc.com/public_case/"
    toVertex: "gdc.cancer.gov/case/"
    label: "gdcRecord"
    fromField: case_submitter_id
    toField: submitter_id

  pdcRecord:
    toVertex: "pdc.esacinc.com/public_case/"
    fromVertex: "gdc.cancer.gov/case/"
    label: "pdcRecord"
    toField: case_submitter_id
    fromField: submitter_id

  pdcFullCase:
    fromVertex: "pdc.esacinc.com/public_case/"
    toVertex: "pdc.esacinc.com/case/"
    label: fullCase
    fromField: case_id
    toField: case_id
